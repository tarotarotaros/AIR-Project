# AIR-Project 機能仕様書

**バージョン**: 0.1.1
**最終更新**: 2025-01-15

## 目次

1. [概要](#概要)
2. [システム要件](#システム要件)
3. [主要機能](#主要機能)
4. [画面構成](#画面構成)
5. [データ管理](#データ管理)
6. [操作仕様](#操作仕様)
7. [制約・制限事項](#制約制限事項)

---

## 概要

### アプリケーション概要

AIR-Projectは、プロジェクト管理をプロセスフローダイアグラムで視覚化するデスクトップアプリケーションです。タスクと成果物の関係性を図で表現し、プロジェクトの全体像を直感的に把握できます。

### 主な特徴

- **ビジュアル管理**: プロセスフロー図でタスク・成果物の関係を可視化
- **ローカルデータ**: SQLiteによる完全なオフライン動作
- **カスタマイズ可能**: マスタデータで組織独自の管理項目を設定
- **エクスポート機能**: Markdown/PDF形式での出力に対応

### 対象ユーザー

- プロジェクトマネージャー
- 個人開発者
- 小規模チームのリーダー

---

## システム要件

### 動作環境

| 項目 | 要件 |
|------|------|
| OS | Windows 10 以降 |
| メモリ | 4GB以上推奨 |
| ディスク | 100MB以上の空き容量 |
| その他 | WebView2 Runtime（自動インストール可） |

### 技術スタック

- **フロントエンド**: React 18.2 + TypeScript 5.2
- **デスクトップ**: Tauri 2.8
- **データベース**: SQLite 3 (@tauri-apps/plugin-sql 2.3)
- **フロー図**: @xyflow/react 12.8 / ReactFlow 11.11
- **UI**: React Icons 5.5
- **ビルド**: Vite 5.0

---

## 主要機能

### 1. プロジェクト管理

#### 1.1 プロジェクト一覧

**機能概要**:
- 登録済みプロジェクトの一覧表示
- プロジェクトの作成・選択・削除

**画面要素**:
- プロジェクト名表示
- 新規作成ボタン
- プロジェクト選択（クリック）

**操作**:
1. 「新規プロジェクト」ボタンをクリック
2. プロジェクト名・説明を入力
3. 保存ボタンで作成完了

**制約**:
- プロジェクト名は必須
- 説明は任意（最大1000文字）

#### 1.2 プロジェクト設定

**機能概要**:
- プロジェクト情報の編集・削除

**編集可能項目**:
- プロジェクト名
- プロジェクト説明

**削除時の動作**:
- 確認モーダルを表示
- 関連する全タスク・成果物・接続を CASCADE 削除

---

### 2. タスク管理

#### 2.1 タスク一覧

**機能概要**:
- プロジェクト内の全タスクを表形式で表示
- タスクの作成・編集・削除

**表示項目**:
| 項目 | 説明 |
|------|------|
| タスク名 | タスクの名称 |
| ステータス | 進捗状況（カラーバッジ） |
| 優先度 | low / medium / high / critical |
| 担当者 | 担当者名 |
| 開始日 | 開始予定日 |
| 終了日 | 終了予定日 |
| 所要日数 | 作業期間（日数） |

**操作**:
- 「新規タスク」ボタン: 作成モーダルを表示
- 行クリック: 編集モーダルを表示
- 削除ボタン: 確認後削除

#### 2.2 タスク作成・編集

**入力項目**:

| 項目 | 必須 | 型 | 制約 |
|------|------|-----|------|
| タスク名 | ✓ | テキスト | 最大200文字 |
| 説明 | - | テキスト | 最大1000文字 |
| ステータス | ✓ | 選択 | タスクステータスマスタから選択 |
| 優先度 | ✓ | 選択 | low / medium / high / critical |
| 担当者 | - | 選択 | 担当者マスタから選択 |
| 開始日 | - | 日付 | YYYY-MM-DD形式 |
| 終了日 | - | 日付 | YYYY-MM-DD形式 |
| 所要日数 | - | 数値 | 正の整数 |

**デフォルト値**:
- 優先度: medium
- ステータス: 未着手（ID=1）

---

### 3. 成果物管理

#### 3.1 成果物一覧

**機能概要**:
- プロジェクト内の全成果物を表形式で表示
- 成果物の作成・編集・削除

**表示項目**:
| 項目 | 説明 |
|------|------|
| 成果物名 | 成果物の名称 |
| ステータス | 進捗状況（カラーバッジ） |
| 種類 | 成果物種類（アイコン付き） |
| 期限 | 完成期限日 |

**操作**:
- 「新規成果物」ボタン: 作成モーダルを表示
- 行クリック: 編集モーダルを表示
- 削除ボタン: 確認後削除

#### 3.2 成果物作成・編集

**入力項目**:

| 項目 | 必須 | 型 | 制約 |
|------|------|-----|------|
| 成果物名 | ✓ | テキスト | 最大200文字 |
| 説明 | - | テキスト | 最大1000文字 |
| ステータス | ✓ | 選択 | 成果物ステータスマスタから選択 |
| 種類 | ✓ | 選択 | 成果物種類マスタから選択 |
| 期限 | - | 日付 | YYYY-MM-DD形式 |

**デフォルト値**:
- ステータス: 未作成（ID=1）
- 種類: 設計書（ID=1）

---

### 4. プロセスフロー

#### 4.1 フロー図表示

**機能概要**:
- タスク・成果物をノードとして配置
- ノード間の依存関係を矢印で表示
- ドラッグ&ドロップによるレイアウト調整

**ノード表示**:

**タスクノード（青系）**:
```
┌─────────────────┐
│ タスク名        │
├─────────────────┤
│ ステータス      │
│ 担当者          │
│ 期間            │
└─────────────────┘
```

**成果物ノード（緑系）**:
```
┌─────────────────┐
│ 📄 成果物名     │
├─────────────────┤
│ ステータス      │
│ 種類            │
│ 期限            │
└─────────────────┘
```

**ノードのカラーリング**:
- ステータスの色で枠線を表示
- 優先度により背景色の濃淡を調整（タスクのみ）

#### 4.2 接続（依存関係）

**操作**:
1. ノードの右端にマウスオーバー（接続ポイント表示）
2. ドラッグ開始
3. 接続先ノードの左端にドロップ

**接続の種類**:
- Task → Task
- Task → Deliverable
- Deliverable → Task
- Deliverable → Deliverable

**接続の削除**:
- 接続線を選択して Delete キー
- または右クリックメニューから削除

#### 4.3 自動レイアウト

**機能概要**:
- Dagre アルゴリズムによる自動配置
- 階層的なレイアウトを生成

**実行方法**:
- 「自動レイアウト」ボタンをクリック

**配置ルール**:
- 依存関係に基づき左から右へ配置
- 同階層のノードは上下に並べる

#### 4.4 エクスポート機能

**Markdown エクスポート**:
- Mermaid記法のフロー図
- JSON形式の詳細データ
- 保存形式: .md ファイル

**PDF エクスポート**:
- フロー図を画像化してPDF出力
- タスク一覧・成果物一覧を表形式で含む
- 保存形式: .pdf ファイル

**実行方法**:
1. 「エクスポート」ボタンをクリック
2. フォーマット選択（Markdown / PDF）
3. 保存先を指定

---

### 5. マスタ管理

#### 5.1 共通マスタ管理画面

**アクセス方法**:
- ヘッダーの「共通マスタ」ボタンをクリック

**管理対象マスタ**:
1. タスクステータスマスタ
2. 成果物ステータスマスタ
3. 担当者マスタ
4. 成果物種類マスタ

#### 5.2 タスクステータスマスタ

**管理項目**:
| 項目 | 必須 | 説明 |
|------|------|------|
| ステータス名 | ✓ | ステータスの名称 |
| 表示色 | ✓ | HEX形式（#RRGGBB） |
| 表示順序 | ✓ | 数値（昇順） |

**デフォルトデータ**:
1. 未着手（#9ca3af）
2. 進行中（#3b82f6）
3. 完了（#10b981）
4. ブロック（#ef4444）

**操作**:
- 新規作成: 「追加」ボタン
- 編集: 行クリック
- 削除: 削除ボタン（使用中の場合はエラー）
- 並び替え: ↑↓ボタン

#### 5.3 成果物ステータスマスタ

**管理項目**:
| 項目 | 必須 | 説明 |
|------|------|------|
| ステータス名 | ✓ | ステータスの名称 |
| 表示色 | ✓ | HEX形式（#RRGGBB） |
| 表示順序 | ✓ | 数値（昇順） |

**デフォルトデータ**:
1. 未作成（#9ca3af）
2. 作成中（#3b82f6）
3. レビュー中（#f59e0b）
4. 完成（#10b981）

#### 5.4 担当者マスタ

**管理項目**:
| 項目 | 必須 | 説明 |
|------|------|------|
| 担当者名 | ✓ | 担当者の名前 |
| メールアドレス | - | 連絡先メール |
| 役割 | - | 職種・役割 |
| 表示順序 | ✓ | 数値（昇順） |

**デフォルトデータ**:
1. 未割当（メール・役割なし）
2. 山田太郎（yamada@example.com / エンジニア）
3. 佐藤花子（sato@example.com / デザイナー）

#### 5.5 成果物種類マスタ

**管理項目**:
| 項目 | 必須 | 説明 |
|------|------|------|
| 種類名 | ✓ | 成果物種類の名称 |
| アイコン | ✓ | React Icons名（例: MdDescription） |
| 表示色 | ✓ | HEX形式（#RRGGBB） |
| 表示順序 | ✓ | 数値（昇順） |

**デフォルトデータ**:
1. 設計書（MdDescription / #3b82f6）
2. コード（MdCode / #10b981）
3. テストケース（MdFactCheck / #f59e0b）
4. ドキュメント（MdArticle / #8b5cf6）

**利用可能アイコン**:
- Material Design Icons（react-icons/md）
- 例: MdDescription, MdCode, MdArticle, MdFactCheck, MdBugReport, MdSettings など

#### 5.6 マスタ管理の共通仕様

**リアルタイム反映**:
- マスタデータ変更時、使用中の画面に即座に反映
- タスク/成果物の表示色・名称が自動更新

**削除制約**:
- 使用中のマスタデータは削除不可
- 削除前に全プロジェクトのタスク・成果物をチェック
- 使用中の場合はエラーモーダルを表示

**並び替え**:
- ↑↓ボタンで表示順序を変更
- セレクトボックス内の表示順に反映

---

## 画面構成

### メイン画面レイアウト

```
┌────────────────────────────────────────────────────────┐
│  ☰  AIR-Project                      [共通マスタ] ⚙️    │ ← ヘッダー
├─────────┬──────────────────────────────────────────────┤
│         │  [タスク一覧] [成果物一覧] [プロセスフロー]  │ ← タブ
│ プロジ  ├──────────────────────────────────────────────┤
│ ェクト  │                                              │
│ 一覧    │                                              │
│         │              コンテンツエリア                 │
│ ▶ PJ1   │                                              │
│   PJ2   │                                              │
│   PJ3   │                                              │
│         │                                              │
│ [新規]  │                                              │
└─────────┴──────────────────────────────────────────────┘
```

### 画面構成要素

#### ヘッダー
- サイドバー開閉ボタン（☰）
- アプリケーション名
- 共通マスタ管理ボタン

#### サイドバー
- プロジェクト一覧
- プロジェクト選択
- 新規プロジェクトボタン
- 折りたたみ可能

#### タブ
1. **タスク一覧**: タスクの表形式表示
2. **成果物一覧**: 成果物の表形式表示
3. **プロセスフロー**: フロー図表示

---

## データ管理

### データ保存場所

**Windows**:
```
%APPDATA%\com.airproject.dev\data.db
```

**実際のパス例**:
```
C:\Users\{ユーザー名}\AppData\Roaming\com.airproject.dev\data.db
```

### データベース構造

詳細は [`database-schema.md`](./database-schema.md) を参照。

**主要テーブル**:
- projects（プロジェクト）
- tasks（タスク）
- deliverables（成果物）
- flow_connections（フロー接続）
- task_status_masters（タスクステータスマスタ）
- deliverable_status_masters（成果物ステータスマスタ）
- assignee_masters（担当者マスタ）
- deliverable_type_masters（成果物種類マスタ）

### バックアップ

**手動バックアップ**:
1. アプリケーションを終了
2. `data.db` ファイルをコピー
3. 安全な場所に保存

**復元**:
1. アプリケーションを終了
2. バックアップファイルを `data.db` に上書き
3. アプリケーションを起動

---

## 操作仕様

### キーボードショートカット

**プロセスフロー画面**:
| キー | 操作 |
|------|------|
| Delete | 選択中のノード/接続を削除 |
| Ctrl + マウスホイール | ズームイン/アウト |
| Space + ドラッグ | キャンバスの移動 |
| Ctrl + Z | 元に戻す（未実装） |
| Ctrl + Y | やり直し（未実装） |

### マウス操作

**プロセスフロー画面**:
| 操作 | 動作 |
|------|------|
| ノードをドラッグ | ノードの移動 |
| 接続ポイントをドラッグ | 新規接続の作成 |
| 接続線をクリック | 接続の選択 |
| 空白領域をドラッグ | キャンバスの移動 |
| マウスホイール | ズームイン/アウト |

---

## 制約・制限事項

### データ制約

**文字数制限**:
- プロジェクト名: 200文字
- タスク名: 200文字
- 成果物名: 200文字
- 説明: 1000文字
- ステータス名: 50文字
- 担当者名: 100文字

**数値制限**:
- 所要日数: 1～9999日
- 表示順序: 0～9999

### 機能制限

**削除制限**:
- 使用中のマスタデータは削除不可
- プロジェクト削除時は全関連データをCASCADE削除

**接続制限**:
- 同一ノード間の重複接続は可能
- 自己参照（自分→自分）も可能

### パフォーマンス

**推奨規模**:
- 1プロジェクトあたり: 100タスク + 50成果物
- 総プロジェクト数: 100個まで

**制限値**:
- 理論上の制限なし（SQLiteの制限に依存）
- 大規模データでは動作が重くなる可能性あり

### ブラウザ動作

**Web版の制限**:
- SQLite機能は動作しない（mockDatabase使用）
- データは永続化されない
- エクスポート機能は利用可能

---

## 将来の拡張予定

### Phase 2（予定）

- [ ] ガントチャート表示
- [ ] リソース管理機能
- [ ] プロジェクトテンプレート
- [ ] カスタムフィールド

### Phase 3（検討中）

- [ ] クラウド同期
- [ ] チーム共有機能
- [ ] リアルタイム共同編集
- [ ] モバイルアプリ対応

---

## 付録

### 関連ドキュメント

- [データベーススキーマ定義](./database-schema.md)
- [開発ガイド](./development.md)
- [ファイルフォーマット仕様](./file_format_sample.md)
- [プロジェクト設定（CLAUDE.md）](../CLAUDE.md)

### バージョン履歴

| バージョン | リリース日 | 主な変更 |
|-----------|-----------|---------|
| 0.1.1 | 2025-01-15 | SQLiteデータベース完全実装、CRUD操作修正 |
| 0.1.0 | 2025-01-14 | 初回リリース、基本機能実装 |

### ライセンス

本ソフトウェアのライセンスについては、プロジェクトルートの LICENSE ファイルを参照してください。

---

**文書バージョン**: 1.0
**作成日**: 2025-01-15
